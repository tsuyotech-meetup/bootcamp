import{_ as u,c as r,e as p,b as s,a as e,t as k,d as a,w as l,r as c,o as d}from"./app-fxwJ5PoU.js";const v={},m={id:"page-frontmatter-title",tabindex:"-1"},b={class:"header-anchor",href:"#page-frontmatter-title"};function g(i,n){const o=c("header-table"),t=c("RouteLink");return d(),r("div",null,[p(o),s("h1",m,[s("a",b,[s("span",null,k(i.$page.frontmatter.title),1)])]),n[5]||(n[5]=e('<h2 id="å­¦ç¿’ç›®æ¨™" tabindex="-1"><a class="header-anchor" href="#å­¦ç¿’ç›®æ¨™"><span>å­¦ç¿’ç›®æ¨™</span></a></h2><p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p><ul><li><strong>Docker Composeã®åŸºæœ¬æ§‹æ–‡ã‚’ç†è§£</strong>ã—ã€è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã‚’é€£æºã§ãã‚‹</li><li><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ </strong>ã‚’ä½¿ã£ãŸæ°¸ç¶šåŒ–ã¨ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’å®Ÿè£…ã§ãã‚‹</li><li><strong>å®Ÿç”¨çš„ãªé–‹ç™ºç’°å¢ƒ</strong>ã‚’ Docker Compose ã§æ§‹ç¯‰ã§ãã‚‹</li><li><strong>ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</strong>ã«ã‚ˆã‚‹ç¢ºå®Ÿãªèµ·å‹•é †åºåˆ¶å¾¡ã‚’é©ç”¨ã§ãã‚‹</li></ul><h2 id="äº‹å‰æº–å‚™" tabindex="-1"><a class="header-anchor" href="#äº‹å‰æº–å‚™"><span>äº‹å‰æº–å‚™</span></a></h2><h3 id="å‰ææ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#å‰ææ¡ä»¶"><span>å‰ææ¡ä»¶</span></a></h3>',5)),s("ul",null,[s("li",null,[p(t,{to:"/dev/container/01_dockerfile_basic.html"},{default:l(()=>n[0]||(n[0]=[a("ç¬¬1éƒ¨: DockerfileåŸºç¤ç·¨")])),_:1}),n[1]||(n[1]=a("ã‚’å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨"))]),n[2]||(n[2]=s("li",null,"å‰ç« ã§ä½œæˆã—ãŸ Flask ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨",-1))]),n[6]||(n[6]=e(`<h3 id="ä½œæ¥­ãƒ†ã‚™ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™" tabindex="-1"><a class="header-anchor" href="#ä½œæ¥­ãƒ†ã‚™ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™"><span>ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> docker-handson</span>
<span class="line"><span class="token function">mkdir</span> 02-compose</span>
<span class="line"><span class="token builtin class-name">cd</span> 02-compose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker-composeã¨ã¯" tabindex="-1"><a class="header-anchor" href="#docker-composeã¨ã¯"><span>Docker Composeã¨ã¯</span></a></h2><p><strong>Docker Compose</strong>ã¯ã€è¤‡æ•°ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å®šç¾©ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆã‚’è¨˜è¿°ã—ã€ä¸€ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã§è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ãƒ»åœæ­¢ã§ãã¾ã™ã€‚</p><h3 id="docker-composeã®åˆ©ç‚¹" tabindex="-1"><a class="header-anchor" href="#docker-composeã®åˆ©ç‚¹"><span>Docker Composeã®åˆ©ç‚¹</span></a></h3><table><thead><tr><th>åˆ©ç‚¹</th><th>èª¬æ˜</th></tr></thead><tbody><tr><td><strong>ç°¡å˜ãªæ§‹æˆç®¡ç†</strong></td><td>YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¸€å…ƒç®¡ç†</td></tr><tr><td><strong>ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡</strong></td><td>è‡ªå‹•çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½œæˆã¨åå‰è§£æ±º</td></tr><tr><td><strong>ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–</strong></td><td>ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ä¿æŒ</td></tr><tr><td><strong>ç’°å¢ƒã®å†ç¾æ€§</strong></td><td>é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»æœ¬ç•ªç’°å¢ƒã®çµ±ä¸€</td></tr><tr><td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td><td>ã‚µãƒ¼ãƒ“ã‚¹ã®è¤‡è£½ã¨è² è·åˆ†æ•£</td></tr></tbody></table><h3 id="åŸºæœ¬çš„ãªcomposeå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬çš„ãªcomposeå‘½ä»¤"><span>åŸºæœ¬çš„ãªComposeå‘½ä»¤</span></a></h3><table><thead><tr><th>å‘½ä»¤</th><th>èª¬æ˜</th><th>ä¾‹</th></tr></thead><tbody><tr><td><code>docker compose up</code></td><td>ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•</td><td><code>docker compose up -d</code></td></tr><tr><td><code>docker compose down</code></td><td>ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ãƒ»å‰Šé™¤</td><td><code>docker compose down</code></td></tr><tr><td><code>docker compose logs</code></td><td>ãƒ­ã‚°ã‚’è¡¨ç¤º</td><td><code>docker compose logs app</code></td></tr><tr><td><code>docker compose ps</code></td><td>å®Ÿè¡Œä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¡¨ç¤º</td><td><code>docker compose ps</code></td></tr><tr><td><code>docker compose exec</code></td><td>ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ</td><td><code>docker compose exec app bash</code></td></tr></tbody></table><h2 id="ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³1-æœ€åˆã®compose-flask-nginx" tabindex="-1"><a class="header-anchor" href="#ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³1-æœ€åˆã®compose-flask-nginx"><span>ãƒãƒ³ã‚ºã‚ªãƒ³1: æœ€åˆã®Compose - Flask + NGINX</span></a></h2><h3 id="ç›®æ¨™" tabindex="-1"><a class="header-anchor" href="#ç›®æ¨™"><span>ğŸ¯ ç›®æ¨™</span></a></h3><p>å‰ç« ã§ä½œæˆã—ãŸFlaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«NGINXã‚’è¿½åŠ ã—ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·æ§‹æˆã‚’ä½œæˆã—ã¾ã™ã€‚</p><h3 id="å®Ÿè£…" tabindex="-1"><a class="header-anchor" href="#å®Ÿè£…"><span>ğŸ“ å®Ÿè£…</span></a></h3><p><strong>1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã®æº–å‚™</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> hands-on1-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> hands-on1-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token function">mkdir</span> nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">hands-on1-&lt;user name&gt;/</span>
<span class="line">â”œâ”€â”€ compose.yml</span>
<span class="line">â””â”€â”€ nginx/</span>
<span class="line">    â””â”€â”€ nginx.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. å‰ç« ã®Flaskã‚¢ãƒ—ãƒªã‚’ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># å‰ç« ã§ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> flask-app</span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ©ç”¨å¯èƒ½ãªã‚¤ãƒ¡ãƒ¼ã‚¸ä¾‹ï¼š</span></span>
<span class="line"><span class="token comment"># flask-app-distroless</span></span>
<span class="line"><span class="token comment"># flask-app-after</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. NGINXã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</strong></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment"># nginx/nginx.conf</span></span>
<span class="line"><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">upstream</span> flask_app</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server</span> app:5000</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/access.log</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/error.log</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># Flask ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ãƒ—ãƒ­ã‚­ã‚·</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_pass</span> http://flask_app</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># NGINX ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆç›£è¦–ç”¨ï¼‰</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /nginx-status</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">allow</span> 127.0.0.1</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">allow</span> 10.0.0.0/8</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. æœ€åˆã®compose.ymlã‚’ä½œæˆ</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token comment"># compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">app</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> flask<span class="token punctuation">-</span>app<span class="token punctuation">-</span>distroless<span class="token punctuation">-</span>&lt;user name<span class="token punctuation">&gt;</span></span>
<span class="line">    <span class="token comment"># image: flask-app-before-&lt;user name&gt;</span></span>
<span class="line">    <span class="token comment"># image: flask-app-after-&lt;user name&gt;</span></span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>network</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">nginx</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080:80&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./nginx/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf<span class="token punctuation">:</span>ro</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">app-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># èµ·å‹•çŠ¶æ³ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token function">ps</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ­ã‚°ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose logs <span class="token parameter variable">-f</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‹•ä½œç¢ºèª" tabindex="-1"><a class="header-anchor" href="#å‹•ä½œç¢ºèª"><span>âœ… å‹•ä½œç¢ºèª</span></a></h3><p><strong>1. Webã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯curlã§ã‚¢ã‚¯ã‚»ã‚¹</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:8080/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># NGINXã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:8080/nginx-status</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># NGINXã‹ã‚‰Flaskã¸ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> nginx <span class="token function">ping</span> app</span>
<span class="line"></span>
<span class="line"><span class="token comment"># NGINXã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰Flaskã«ã‚¢ã‚¯ã‚»ã‚¹</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> nginx <span class="token function">curl</span> http://app:5000/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. ãƒ­ã‚°ã®ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># NGINXã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°</span></span>
<span class="line"><span class="token function">docker</span> compose logs nginx <span class="token parameter variable">-n</span> <span class="token number">20</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Flaskã‚¢ãƒ—ãƒªã®ãƒ­ã‚°</span></span>
<span class="line"><span class="token function">docker</span> compose logs <span class="token parameter variable">-f</span> app</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è§£èª¬" tabindex="-1"><a class="header-anchor" href="#è§£èª¬"><span>ğŸ’¡ è§£èª¬</span></a></h3><p><strong>é‡è¦ãªæ¦‚å¿µ:</strong></p><ul><li><strong>networks</strong>: <code>app-network</code>ã§ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’å®Ÿç¾</li><li><strong>depends_on</strong>: NGINXãŒFlaskã‚ˆã‚Šå¾Œã«èµ·å‹•ã™ã‚‹ã‚ˆã†åˆ¶å¾¡</li><li><strong>volumes</strong>: NGINXè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¦ãƒ³ãƒˆ</li><li><strong>ã‚µãƒ¼ãƒ“ã‚¹åã«ã‚ˆã‚‹åå‰è§£æ±º</strong>: <code>app:5000</code>ã§Flaskã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</li></ul><p><strong>ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã®åˆ©ç‚¹:</strong></p><ul><li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®åˆ†é›¢</li><li>é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã®é«˜é€ŸåŒ–</li><li>SSLçµ‚ç«¯ã‚„ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã®ä¸€å…ƒåŒ–</li></ul><h2 id="ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³2-flask-mysql-ãƒ†ã‚™ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯" tabindex="-1"><a class="header-anchor" href="#ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³2-flask-mysql-ãƒ†ã‚™ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"><span>ãƒãƒ³ã‚ºã‚ªãƒ³2: Flask + MySQL - ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</span></a></h2><h3 id="ç›®æ¨™-1" tabindex="-1"><a class="header-anchor" href="#ç›®æ¨™-1"><span>ğŸ¯ ç›®æ¨™</span></a></h3><ul><li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®é€£æºã§ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã‚’å®Ÿç¾</li><li>ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ç¢ºå®Ÿãªã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•é †åºåˆ¶å¾¡</li><li>å®Ÿç”¨çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Œæˆ</li></ul><h3 id="å®Ÿè£…-1" tabindex="-1"><a class="header-anchor" href="#å®Ÿè£…-1"><span>ğŸ“ å®Ÿè£…</span></a></h3><p><strong>1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> hands-on2-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> hands-on2-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> app/templates mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">hands-on2-&lt;user name&gt;/</span>
<span class="line">â”œâ”€â”€ compose.yml</span>
<span class="line">â”œâ”€â”€ Dockerfile</span>
<span class="line">â”œâ”€â”€ app/</span>
<span class="line">â”‚   â”œâ”€â”€ templates/</span>
<span class="line">â”‚   â”‚   â””â”€â”€ index.html</span>
<span class="line">â”‚   â”œâ”€â”€ main.py</span>
<span class="line">â”‚   â””â”€â”€ requirements.txt</span>
<span class="line">â””â”€â”€ mysql/</span>
<span class="line">    â””â”€â”€ init.sql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã®Flaskã‚¢ãƒ—ãƒª</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> render_template</span>
<span class="line"><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector</span>
<span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime</span>
<span class="line"></span>
<span class="line">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</span></span>
<span class="line">DB_CONFIG <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;DB_NAME&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;flask_app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;DB_USER&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;flask_user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;password&#39;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;DB_PASSWORD&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;flask_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_db_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token operator">**</span>DB_CONFIG<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>Error <span class="token keyword">as</span> err<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Database connection error: </span><span class="token interpolation"><span class="token punctuation">{</span>err<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># è¨ªå•è¨˜éŒ²ã‚’ä¿å­˜</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;INSERT INTO visits (ip_address, timestamp, user_agent) VALUES (%s, %s, %s)&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">(</span>request<span class="token punctuation">.</span>remote_addr<span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># ç·è¨ªå•æ•°ã‚’å–å¾—</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT COUNT(*) FROM visits&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        visit_count <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># æœ€è¿‘ã®è¨ªå•å±¥æ­´ã‚’å–å¾—</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT ip_address, timestamp FROM visits ORDER BY timestamp DESC LIMIT 10&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        recent_visits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&#39;ip_address&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;timestamp&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                visit_count<span class="token operator">=</span>visit_count<span class="token punctuation">,</span></span>
<span class="line">                                database_status<span class="token operator">=</span><span class="token string">&#39;connected&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                current_time<span class="token operator">=</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                recent_visits<span class="token operator">=</span>recent_visits<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Database connection failed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/api/visits&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">api_visits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT ip_address, timestamp, user_agent FROM visits ORDER BY timestamp DESC LIMIT 50&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        visits <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;ip_address&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;timestamp&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;user_agent&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;visits&#39;</span><span class="token punctuation">:</span> visits<span class="token punctuation">,</span> <span class="token string">&#39;count&#39;</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>visits<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Database connection failed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/health&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;status&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;healthy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;connected&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;status&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;unhealthy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;disconnected&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;0.0.0.0&#39;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. ä¾å­˜é–¢ä¿‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</strong></p><div class="language-txt line-numbers-mode" data-highlighter="prismjs" data-ext="txt"><pre><code><span class="line"># app/requirements.txt</span>
<span class="line">flask==3.1.1</span>
<span class="line">mysql-connector-python==9.3.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ</strong></p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code><span class="line"><span class="token comment">&lt;!-- app/templates/index.html --&gt;</span></span>
<span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ja<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Flask + MySQL ã‚¢ãƒ—ãƒª<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span>
<span class="line">        <span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.container</span> <span class="token punctuation">{</span> <span class="token property">max-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.header</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> #2196F3<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.stats</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #e3f2fd<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px 0<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.visits</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #f3e5f5<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px 0<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.visit-item</span> <span class="token punctuation">{</span> <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #ddd<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-links</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px 0<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-links a</span> <span class="token punctuation">{</span> <span class="token property">margin-right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> #1976d2<span class="token punctuation">;</span> <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-links a:hover</span> <span class="token punctuation">{</span> <span class="token property">text-decoration</span><span class="token punctuation">:</span> underline<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ğŸ³ Flask + MySQL ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stats<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ç·è¨ªå•æ•°:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ visit_count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ database_status }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ç¾åœ¨æ™‚åˆ»:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ current_time }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visits<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>æœ€è¿‘ã®è¨ªå•å±¥æ­´<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            {% for visit in recent_visits %}</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visit-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>{{ visit.timestamp }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> - {{ visit.ip_address }}</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            {% endfor %}</span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-links<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/api/visits<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>GET /api/visits<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/health<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>GET /health<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/nginx-health<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>GET /nginx-health<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. Dockerfileã‚’ä½œæˆ</strong></p><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code><span class="line"><span class="token comment"># Dockerfile</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> python:3.13-slim</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> app/requirements.txt .</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get install -y --no-install-recommends curl &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    pip install --no-cache-dir -r requirements.txt &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get clean &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> app/ .</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼šérootãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> adduser --disabled-password --no-create-home appuser &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    chown -R appuser:appuser /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">USER</span> appuser</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒãƒ¼ãƒˆã‚’å…¬é–‹</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 5000</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;python&quot;</span>, <span class="token string">&quot;main.py&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. MySQLåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token comment">-- mysql/init.sql</span></span>
<span class="line"><span class="token keyword">USE</span> flask_app<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> visits <span class="token punctuation">(</span></span>
<span class="line">    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">    ip_address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">timestamp</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    user_agent <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">INDEX</span> idx_timestamp <span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">INDEX</span> idx_ip <span class="token punctuation">(</span>ip_address<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> visits <span class="token punctuation">(</span>ip_address<span class="token punctuation">,</span> <span class="token keyword">timestamp</span><span class="token punctuation">,</span> user_agent<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> </span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Initial Setup Browser&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;192.168.1.100&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Test User Agent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;10.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Docker Health Check&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä»˜ãcompose.yml</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token comment"># compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">app</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span> .</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;5000:5000&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line">      <span class="token punctuation">-</span> DB_HOST=db</span>
<span class="line">      <span class="token punctuation">-</span> DB_NAME=flask_app</span>
<span class="line">      <span class="token punctuation">-</span> DB_USER=flask_user</span>
<span class="line">      <span class="token punctuation">-</span> DB_PASSWORD=flask_password</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">condition</span><span class="token punctuation">:</span> service_healthy  <span class="token comment"># DBã®å®Œå…¨èµ·å‹•ã‚’å¾…ã¤</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:5000/health&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s</span>
<span class="line">      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s</span>
<span class="line">      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">      <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 40s</span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>8.0<span class="token punctuation">-</span>bookworm</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=root_password</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=flask_app</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_USER=flask_user</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PASSWORD=flask_password</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql</span>
<span class="line">      <span class="token punctuation">-</span> ./mysql/init.sql<span class="token punctuation">:</span>/docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d/init.sql<span class="token punctuation">:</span>ro</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysqladmin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ping&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-h&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-u&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flask_user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-pflask_password&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 20s</span>
<span class="line">      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">      <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 30s</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">app-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">mysql_data</span><span class="token punctuation">:</span>  <span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‹•ä½œç¢ºèª-1" tabindex="-1"><a class="header-anchor" href="#å‹•ä½œç¢ºèª-1"><span>âœ… å‹•ä½œç¢ºèª</span></a></h3><p><strong>1. ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># èµ·å‹•çŠ¶æ³ã‚’ç¢ºèªï¼ˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚‚å«ã‚€ï¼‰</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token function">ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># Webãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯curlã§ã‚¢ã‚¯ã‚»ã‚¹</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:5000/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># JSON APIã®ç¢ºèª</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:5000/api/visits <span class="token operator">|</span> jq</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç¢ºèª</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:5000/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è¤‡æ•°å›ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦è¨ªå•æ•°ã®å¢—åŠ ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:5000/ <span class="token operator">|</span> <span class="token function">grep</span> visit_count<span class="token punctuation">;</span> <span class="token keyword">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç›´æ¥ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># MySQLã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶š</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> db mysql <span class="token parameter variable">-u</span> flask_user <span class="token parameter variable">-pflask_password</span> flask_app</span>
<span class="line"></span>
<span class="line"><span class="token comment"># SQLã§è¨ªå•è¨˜éŒ²ã‚’ç¢ºèª</span></span>
<span class="line">SELECT id, ip_address, timestamp FROM visits ORDER BY timestamp DESC LIMIT <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ç¢ºèª</span></span>
<span class="line">DESCRIBE visits<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã®ç¢ºèª</span></span>
<span class="line">SELECT COUNT<span class="token punctuation">(</span>*<span class="token punctuation">)</span> as total_visits FROM visits<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">EXIT<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®å‹•ä½œç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ˜ãƒ«ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> inspect <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> compose <span class="token function">ps</span> <span class="token parameter variable">-q</span> app<span class="token variable">)</span></span> <span class="token operator">|</span> jq <span class="token string">&#39;.[0].State.Health&#39;</span></span>
<span class="line"><span class="token function">docker</span> inspect <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> compose <span class="token function">ps</span> <span class="token parameter variable">-q</span> db<span class="token variable">)</span></span> <span class="token operator">|</span> jq <span class="token string">&#39;.[0].State.Health&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose down</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å†åº¦èµ·å‹•ã—ã¦ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Volumeã”ã¨å‰Šé™¤</span></span>
<span class="line"><span class="token function">docker</span> compose down <span class="token parameter variable">-v</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é‡è¦ãªå­¦ç¿’ãƒ›ã‚šã‚¤ãƒ³ãƒˆ" tabindex="-1"><a class="header-anchor" href="#é‡è¦ãªå­¦ç¿’ãƒ›ã‚šã‚¤ãƒ³ãƒˆ"><span>ğŸ’¡ é‡è¦ãªå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ</span></a></h3><p><strong>1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹èµ·å‹•é †åºåˆ¶å¾¡</strong></p><ul><li><code>condition: service_healthy</code>ã§DBãŒå®Œå…¨ã«èµ·å‹•ã—ã¦ã‹ã‚‰ã‚¢ãƒ—ãƒªãŒèµ·å‹•</li><li>å¾“æ¥ã®<code>depends_on</code>ã ã‘ã§ã¯ä¸ååˆ†ãªå•é¡Œã‚’è§£æ±º</li></ul><p><strong>2. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®ä»•çµ„ã¿</strong></p><ul><li><code>mysql_data</code>ãƒœãƒªãƒ¥ãƒ¼ãƒ ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒ</li><li>åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯åˆå›èµ·å‹•æ™‚ã®ã¿å®Ÿè¡Œ</li></ul><p><strong>3. ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†</strong></p><ul><li>ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã¦è¨­å®šã‚’å¤–éƒ¨åŒ–</li><li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ä¿å®ˆæ€§ã®å‘ä¸Š</li></ul><p><strong>4. ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡</strong></p><ul><li>Docker ComposeãŒè‡ªå‹•çš„ã«å†…éƒ¨DNSã‚’æä¾›</li><li><code>app</code>ã‹ã‚‰<code>db:3306</code>ã§MySQLã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</li></ul><h2 id="ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³3-webä¸‰å±¤æ§‹æˆ-å®Ÿç”¨çš„ãªwebã‚¢ãƒ•ã‚šãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³" tabindex="-1"><a class="header-anchor" href="#ãƒãƒ³ã‚¹ã‚™ã‚ªãƒ³3-webä¸‰å±¤æ§‹æˆ-å®Ÿç”¨çš„ãªwebã‚¢ãƒ•ã‚šãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"><span>ãƒãƒ³ã‚ºã‚ªãƒ³3: Webä¸‰å±¤æ§‹æˆ - å®Ÿç”¨çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span></a></h2><h3 id="ç›®æ¨™-2" tabindex="-1"><a class="header-anchor" href="#ç›®æ¨™-2"><span>ğŸ¯ ç›®æ¨™</span></a></h3><ul><li><strong>ä¸‰å±¤æ§‹æˆ</strong>ï¼ˆNGINX + Flask + MySQLï¼‰ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰</li><li><strong>è² è·åˆ†æ•£</strong>ã«ã‚ˆã‚‹è¤‡æ•°ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®é‹ç”¨</li><li><strong>ç’°å¢ƒå¤‰æ•°ç®¡ç†</strong>ã«ã‚ˆã‚‹é–‹ç™ºãƒ»æœ¬ç•ªè¨­å®šã®åˆ†é›¢</li><li><strong>ç›£è¦–ãƒ»ãƒ­ã‚°æ©Ÿèƒ½</strong>ã‚’æŒã¤å®Ÿç”¨çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Œæˆ</li></ul><h3 id="å®Ÿè£…-2" tabindex="-1"><a class="header-anchor" href="#å®Ÿè£…-2"><span>ğŸ“ å®Ÿè£…</span></a></h3><p><strong>1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">mkdir</span> hans-on3-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> hans-on3-<span class="token operator">&lt;</span>user name<span class="token operator">&gt;</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> app/src/templates nginx mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">flask-web-system/</span>
<span class="line">â”œâ”€â”€ compose.yml</span>
<span class="line">â”œâ”€â”€ .env                # ç’°å¢ƒå¤‰æ•°ç®¡ç†</span>
<span class="line">â”œâ”€â”€ app/</span>
<span class="line">â”‚   â”œâ”€â”€ Dockerfile</span>
<span class="line">â”‚   â””â”€â”€ src/</span>
<span class="line">â”‚       â”œâ”€â”€ templates/</span>
<span class="line">â”‚       â”‚   â””â”€â”€ index.html</span>
<span class="line">â”‚       â”œâ”€â”€ main.py</span>
<span class="line">â”‚       â”œâ”€â”€ requirements.txt</span>
<span class="line">â”‚       â””â”€â”€ config.py  # è¨­å®šç®¡ç†</span>
<span class="line">â”œâ”€â”€ nginx/</span>
<span class="line">â”‚   â””â”€â”€ nginx.conf     # é–‹ç™ºç”¨è¨­å®š</span>
<span class="line">â””â”€â”€ mysql/</span>
<span class="line">     â””â”€â”€ init.sql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ç’°å¢ƒå¤‰æ•°ç®¡ç†</strong></p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre><code><span class="line"><span class="token comment"># .env</span></span>
<span class="line"><span class="token comment"># é–‹ç™ºç’°å¢ƒè¨­å®š</span></span>
<span class="line"><span class="token key attr-name">FLASK_ENV</span><span class="token punctuation">=</span><span class="token value attr-value">development</span></span>
<span class="line"><span class="token key attr-name">FLASK_DEBUG</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</span></span>
<span class="line"><span class="token key attr-name">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">root_password</span></span>
<span class="line"><span class="token key attr-name">MYSQL_DATABASE</span><span class="token punctuation">=</span><span class="token value attr-value">flask_web_app</span></span>
<span class="line"><span class="token key attr-name">MYSQL_USER</span><span class="token punctuation">=</span><span class="token value attr-value">web_user</span></span>
<span class="line"><span class="token key attr-name">MYSQL_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">web_password</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š</span></span>
<span class="line"><span class="token key attr-name">APP_SECRET_KEY</span><span class="token punctuation">=</span><span class="token value attr-value">your-secret-key-change-in-production</span></span>
<span class="line"><span class="token key attr-name">APP_SCALE</span><span class="token punctuation">=</span><span class="token value attr-value">2</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š</span></span>
<span class="line"><span class="token key attr-name">NGINX_PORT</span><span class="token punctuation">=</span><span class="token value attr-value">80</span></span>
<span class="line"><span class="token key attr-name">MYSQL_PORT</span><span class="token punctuation">=</span><span class="token value attr-value">3306</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. è¨­å®šç®¡ç†å¯¾å¿œã®Flaskã‚¢ãƒ—ãƒª</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># app/src/config.py</span></span>
<span class="line"><span class="token keyword">import</span> os</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</span></span>
<span class="line">    DB_HOST <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;db&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    DB_NAME <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;MYSQL_DATABASE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;flask_web_app&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    DB_USER <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;MYSQL_USER&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;web_user&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    DB_PASSWORD <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;MYSQL_PASSWORD&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;web_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Flaskè¨­å®š</span></span>
<span class="line">    SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;APP_SECRET_KEY&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;dev-key&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    DEBUG <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;FLASK_DEBUG&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;false&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;true&#39;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token decorator annotation punctuation">@property</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">DATABASE_URI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;mysql+pymysql://</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>DB_USER<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>DB_PASSWORD<span class="token punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>DB_HOST<span class="token punctuation">}</span></span><span class="token string">:3306/</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>DB_NAME<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DevelopmentConfig</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    DEBUG <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ProductionConfig</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    DEBUG <span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line"></span>
<span class="line">config <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;development&#39;</span><span class="token punctuation">:</span> DevelopmentConfig<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;production&#39;</span><span class="token punctuation">:</span> ProductionConfig<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;default&#39;</span><span class="token punctuation">:</span> DevelopmentConfig</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. æ‹¡å¼µã•ã‚ŒãŸFlaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># app/src/main.py</span></span>
<span class="line"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> render_template</span>
<span class="line"><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector</span>
<span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> socket</span>
<span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime</span>
<span class="line"><span class="token keyword">from</span> config <span class="token keyword">import</span> config</span>
<span class="line"></span>
<span class="line">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è¨­å®šèª­ã¿è¾¼ã¿</span></span>
<span class="line">config_name <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;FLASK_ENV&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">)</span></span>
<span class="line">app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>config<span class="token punctuation">[</span>config_name<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚µãƒ¼ãƒãƒ¼è­˜åˆ¥ç”¨</span></span>
<span class="line">SERVER_ID <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostname<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</span></span>
<span class="line">DB_CONFIG <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;host&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_NAME&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_USER&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;password&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_PASSWORD&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_db_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token operator">**</span>DB_CONFIG<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>Error <span class="token keyword">as</span> err<span class="token punctuation">:</span></span>
<span class="line">        app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Database connection error: </span><span class="token interpolation"><span class="token punctuation">{</span>err<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># è¨ªå•è¨˜éŒ²ã‚’ä¿å­˜ï¼ˆã‚µãƒ¼ãƒãƒ¼IDã‚‚è¨˜éŒ²ï¼‰</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;INSERT INTO visits (ip_address, timestamp, user_agent, server_id) VALUES (%s, %s, %s, %s)&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">(</span>request<span class="token punctuation">.</span>remote_addr<span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SERVER_ID<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># çµ±è¨ˆæƒ…å ±å–å¾—</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT COUNT(*) FROM visits&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        visit_count <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT ip_address, timestamp FROM visits ORDER BY timestamp DESC LIMIT 5&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        recent_visits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&#39;ip_address&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;timestamp&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                server_id<span class="token operator">=</span>SERVER_ID<span class="token punctuation">,</span></span>
<span class="line">                                environment<span class="token operator">=</span>config_name<span class="token punctuation">,</span></span>
<span class="line">                                debug_mode<span class="token operator">=</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DEBUG&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                                current_time<span class="token operator">=</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                database_status<span class="token operator">=</span><span class="token string">&#39;connected&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                db_host<span class="token operator">=</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                                db_name<span class="token operator">=</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_NAME&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                                visit_count<span class="token operator">=</span>visit_count<span class="token punctuation">,</span></span>
<span class="line">                                recent_visits<span class="token operator">=</span>recent_visits<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Database connection failed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/api/stats&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">api_stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># å„ã‚µãƒ¼ãƒãƒ¼ã”ã¨ã®å‡¦ç†æ•°</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT server_id, COUNT(*) as count FROM visits GROUP BY server_id&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        server_stats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&#39;server_id&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;requests&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># æ™‚é–“åˆ¥çµ±è¨ˆ</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">            SELECT DATE_FORMAT(timestamp, &#39;%H:00&#39;) as hour, COUNT(*) as count </span>
<span class="line">            FROM visits </span>
<span class="line">            WHERE DATE(timestamp) = CURDATE() </span>
<span class="line">            GROUP BY hour </span>
<span class="line">            ORDER BY hour</span>
<span class="line">        &quot;&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        hourly_stats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&#39;hour&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;requests&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;server_stats&#39;</span><span class="token punctuation">:</span> server_stats<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;hourly_stats&#39;</span><span class="token punctuation">:</span> hourly_stats<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;current_server&#39;</span><span class="token punctuation">:</span> SERVER_ID</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Database connection failed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/api/visits&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">api_visits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT ip_address, timestamp, user_agent FROM visits ORDER BY timestamp DESC LIMIT 50&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        visits <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;ip_address&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;timestamp&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;user_agent&#39;</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;visits&#39;</span><span class="token punctuation">:</span> visits<span class="token punctuation">,</span> <span class="token string">&#39;count&#39;</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>visits<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Database connection failed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/info&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&#39;server_id&#39;</span><span class="token punctuation">:</span> SERVER_ID<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;environment&#39;</span><span class="token punctuation">:</span> config_name<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;debug&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DEBUG&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;database_host&#39;</span><span class="token punctuation">:</span> app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;timestamp&#39;</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">&#39;/health&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    conn <span class="token operator">=</span> get_db_connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> conn<span class="token punctuation">:</span></span>
<span class="line">        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;status&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;healthy&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;server_id&#39;</span><span class="token punctuation">:</span> SERVER_ID<span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;connected&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;environment&#39;</span><span class="token punctuation">:</span> config_name</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span></span>
<span class="line">    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&#39;status&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;unhealthy&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;server_id&#39;</span><span class="token punctuation">:</span> SERVER_ID<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;database&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;disconnected&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;0.0.0.0&#39;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> debug<span class="token operator">=</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">&#39;DEBUG&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. ä¾å­˜é–¢ä¿‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</strong></p><div class="language-txt line-numbers-mode" data-highlighter="prismjs" data-ext="txt"><pre><code><span class="line"># app/src/requirements.txt</span>
<span class="line">flask==3.1.1</span>
<span class="line">mysql-connector-python==9.3.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6. HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ</strong></p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code><span class="line"><span class="token comment">&lt;!-- app/src/templates/index.html --&gt;</span></span>
<span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ja<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Flask Web System<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"></span>
<span class="line">        <span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&#39;Segoe UI&#39;</span><span class="token punctuation">,</span> Tahoma<span class="token punctuation">,</span> Geneva<span class="token punctuation">,</span> Verdana<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> #667eea 0%<span class="token punctuation">,</span> #764ba2 100%<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">min-height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.container</span> <span class="token punctuation">{</span> <span class="token property">max-width</span><span class="token punctuation">:</span> 1000px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.header</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 4px 15px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.stats-grid</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span> <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fit<span class="token punctuation">,</span> <span class="token function">minmax</span><span class="token punctuation">(</span>300px<span class="token punctuation">,</span> 1fr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">gap</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.stat-card</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 4px 15px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.stat-card h3</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> #2196F3<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.server-info</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #e8f5e8<span class="token punctuation">;</span> <span class="token property">border-left</span><span class="token punctuation">:</span> 4px solid #4caf50<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.db-info</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #fff3e0<span class="token punctuation">;</span> <span class="token property">border-left</span><span class="token punctuation">:</span> 4px solid #ff9800<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.visit-info</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #e3f2fd<span class="token punctuation">;</span> <span class="token property">border-left</span><span class="token punctuation">:</span> 4px solid #2196f3<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.visit-item</span> <span class="token punctuation">{</span> <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-grid</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span> <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fit<span class="token punctuation">,</span> <span class="token function">minmax</span><span class="token punctuation">(</span>200px<span class="token punctuation">,</span> 1fr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">gap</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-link</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> #1976d2<span class="token punctuation">;</span> <span class="token property">transition</span><span class="token punctuation">:</span> all 0.3s<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.api-link:hover</span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> #e3f2fd<span class="token punctuation">;</span> <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-2px<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token selector">.footer</span> <span class="token punctuation">{</span> <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span> <span class="token property">opacity</span><span class="token punctuation">:</span> 0.8<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>ğŸ³ Flask Web System - ä¸‰å±¤æ§‹æˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>NGINX + Flask + MySQL ã«ã‚ˆã‚‹å®Ÿç”¨çš„ãªWebã‚·ã‚¹ãƒ†ãƒ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stats-grid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stat-card server-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼æƒ…å ±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ã‚µãƒ¼ãƒãƒ¼ID:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ server_id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ç’°å¢ƒ:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ environment }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ debug_mode }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ç¾åœ¨æ™‚åˆ»:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ current_time }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            </span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stat-card db-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>çŠ¶æ…‹:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ database_status }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ãƒ›ã‚¹ãƒˆ:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ db_host }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ db_name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>ç·è¨ªå•æ•°:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> {{ visit_count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            </span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stat-card visit-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>ğŸ‘¥ æœ€è¿‘ã®è¨ªå•å±¥æ­´<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                {% for visit in recent_visits %}</span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visit-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ visit.ip_address }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ visit.timestamp.strftime(&#39;%H:%M:%S&#39;) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                {% endfor %}</span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stat-card<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>ğŸ”— API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-grid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/api/visits<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ğŸ“Š è¨ªå•å±¥æ­´API<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/api/stats<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ğŸ“ˆ çµ±è¨ˆAPI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/health<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ğŸ’š ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>api-link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>â„¹ï¸ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Powered by Docker Compose | Server: {{ server_id }} | Load Balanced by NGINX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7. Dockerfileã‚’ä½œæˆ</strong></p><div class="language-docker line-numbers-mode" data-highlighter="prismjs" data-ext="docker"><pre><code><span class="line"><span class="token comment"># app/Dockerfile</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">FROM</span> python:3.13-slim</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> src/requirements.txt .</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get install -y --no-install-recommends curl &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    pip install --no-cache-dir -r requirements.txt &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    apt-get clean &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">COPY</span> src/ .</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼šérootãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">RUN</span> adduser --disabled-password --no-create-home appuser &amp;&amp; <span class="token operator">\\</span></span>
<span class="line">    chown -R appuser:appuser /app</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">USER</span> appuser</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒãƒ¼ãƒˆã‚’å…¬é–‹</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">EXPOSE</span> 5000</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•</span></span>
<span class="line"><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;python&quot;</span>, <span class="token string">&quot;main.py&quot;</span>]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>8. è² è·åˆ†æ•£å¯¾å¿œã®NGINXè¨­å®š</strong></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token comment"># nginx/nginx.conf</span></span>
<span class="line"><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># è² è·åˆ†æ•£è¨­å®š</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">upstream</span> flask_backend</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">least_conn</span></span><span class="token punctuation">;</span>  <span class="token comment"># æœ€å°‘æ¥ç¶šæ•°ã«ã‚ˆã‚‹åˆ†æ•£</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server</span> app:5000 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/access.log</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/error.log</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_pass</span> http://flask_backend</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&#39;upgrade&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">5s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_pass</span> http://flask_backend</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">5s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># NGINX ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆç›£è¦–ç”¨ï¼‰</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /nginx-status</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">allow</span> 127.0.0.1</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">allow</span> 10.0.0.0/8</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>9. æ‹¡å¼µã•ã‚ŒãŸMySQLåˆæœŸåŒ–</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token comment">-- mysql/init.sql</span></span>
<span class="line"><span class="token keyword">USE</span> flask_web_app<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> visits <span class="token punctuation">(</span></span>
<span class="line">    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">    ip_address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">timestamp</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    user_agent <span class="token keyword">TEXT</span><span class="token punctuation">,</span></span>
<span class="line">    server_id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">INDEX</span> idx_timestamp <span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">INDEX</span> idx_ip <span class="token punctuation">(</span>ip_address<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">INDEX</span> idx_server <span class="token punctuation">(</span>server_id<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- è² è·åˆ†æ•£ãƒ†ã‚¹ãƒˆç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> visits <span class="token punctuation">(</span>ip_address<span class="token punctuation">,</span> <span class="token keyword">timestamp</span><span class="token punctuation">,</span> user_agent<span class="token punctuation">,</span> server_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> </span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Load Balancer Test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;initial&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;192.168.1.100&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Development Test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;initial&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token string">&#39;10.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Health Check Test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;initial&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- çµ±è¨ˆç”¨ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆ</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> visit_stats <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">,</span></span>
<span class="line">    server_id<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> request_count<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> ip_address<span class="token punctuation">)</span> <span class="token keyword">as</span> unique_visitors</span>
<span class="line"><span class="token keyword">FROM</span> visits </span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> server_id<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7. ä¸‰å±¤æ§‹æˆã®compose.yml</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token comment"># compose.yml</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ï¼‰</span></span>
<span class="line">  <span class="token key atrule">app</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./app</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line">      <span class="token punctuation">-</span> FLASK_ENV=$<span class="token punctuation">{</span>FLASK_ENV<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> FLASK_DEBUG=$<span class="token punctuation">{</span>FLASK_DEBUG<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_HOST=db</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=$<span class="token punctuation">{</span>MYSQL_DATABASE<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_USER=$<span class="token punctuation">{</span>MYSQL_USER<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PASSWORD=$<span class="token punctuation">{</span>MYSQL_PASSWORD<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> APP_SECRET_KEY=$<span class="token punctuation">{</span>APP_SECRET_KEY<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">condition</span><span class="token punctuation">:</span> service_healthy</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> web<span class="token punctuation">-</span>network</span>
<span class="line">      <span class="token punctuation">-</span> db<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:5000/health&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s</span>
<span class="line">      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s</span>
<span class="line">      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">      <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 40s</span>
<span class="line">    <span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>  <span class="token comment"># è² è·åˆ†æ•£ç”¨ã«2ã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å±¤ï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãƒ»è² è·åˆ†æ•£ï¼‰</span></span>
<span class="line">  <span class="token key atrule">nginx</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;\${NGINX_PORT}:80&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./nginx/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf<span class="token punctuation">:</span>ro</span>
<span class="line">      <span class="token punctuation">-</span> nginx_logs<span class="token punctuation">:</span>/var/log/nginx</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> app</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> web<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost/nginx-status&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s</span>
<span class="line">      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 5s</span>
<span class="line">      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤</span></span>
<span class="line">  <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>8.0<span class="token punctuation">-</span>debian</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=$<span class="token punctuation">{</span>MYSQL_ROOT_PASSWORD<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=$<span class="token punctuation">{</span>MYSQL_DATABASE<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_USER=$<span class="token punctuation">{</span>MYSQL_USER<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PASSWORD=$<span class="token punctuation">{</span>MYSQL_PASSWORD<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;\${MYSQL_PORT}:3306&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql</span>
<span class="line">      <span class="token punctuation">-</span> ./mysql/init.sql<span class="token punctuation">:</span>/docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d/init.sql<span class="token punctuation">:</span>ro</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mysqladmin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ping&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-h&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-u&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\${MYSQL_USER}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-p\${MYSQL_PASSWORD}&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 20s</span>
<span class="line">      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">      <span class="token key atrule">start_period</span><span class="token punctuation">:</span> 30s</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># ç›£è¦–ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</span></span>
<span class="line">  <span class="token key atrule">adminer</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer<span class="token punctuation">:</span>5.3.0<span class="token punctuation">-</span>standalone</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db</span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db<span class="token punctuation">-</span>network</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> TZ=Asia/Tokyo</span>
<span class="line">      <span class="token punctuation">-</span> ADMINER_DEFAULT_SERVER=db</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">web-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line">  <span class="token key atrule">db-network</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">mysql_data</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">nginx_logs</span><span class="token punctuation">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‹•ä½œç¢ºèª-2" tabindex="-1"><a class="header-anchor" href="#å‹•ä½œç¢ºèª-2"><span>âœ… å‹•ä½œç¢ºèª</span></a></h3><p><strong>1. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®èµ·å‹•</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª</span></span>
<span class="line"><span class="token function">cat</span> .env</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># èµ·å‹•çŠ¶æ³ã®ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token function">ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. è² è·åˆ†æ•£ã®ç¢ºèª</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># è¤‡æ•°å›ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç•°ãªã‚‹ã‚µãƒ¼ãƒãƒ¼IDãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">  <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost/ <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;ã‚µãƒ¼ãƒãƒ¼ID&quot;</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;Request <span class="token variable">$i</span>&quot;</span></span>
<span class="line">  <span class="token function">sleep</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># å„ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> nginx <span class="token function">curl</span> http://localhost/nginx-status</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å­¦ç¿’ãƒ›ã‚šã‚¤ãƒ³ãƒˆ" tabindex="-1"><a class="header-anchor" href="#å­¦ç¿’ãƒ›ã‚šã‚¤ãƒ³ãƒˆ"><span>ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ</span></a></h3><p><strong>ä¸‰å±¤æ§‹æˆã®ç†è§£:</strong></p><ul><li><strong>ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤</strong>: NGINXï¼ˆé™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã€SSLçµ‚ç«¯ã€è² è·åˆ†æ•£ï¼‰</li><li><strong>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤</strong>: Flaskï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€APIæä¾›ï¼‰</li><li><strong>ãƒ‡ãƒ¼ã‚¿å±¤</strong>: MySQLï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰</li></ul><p><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£:</strong></p><ul><li>æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆãƒ¬ãƒ—ãƒªã‚«æ•°ã®èª¿æ•´ï¼‰</li><li>è² è·åˆ†æ•£ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆleast_connï¼‰</li><li>ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹éšœå®³æ¤œçŸ¥</li></ul><p><strong>é‹ç”¨è€ƒæ…®äº‹é …:</strong></p><ul><li>ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†</li><li>ãƒ­ã‚°ã®é›†ç´„ã¨ç›£è¦–</li><li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®é©ç”¨</li><li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</li></ul><h2 id="ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•"><span>ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•</span></a></h2><h3 id="å•é¡Œ1-ãƒ†ã‚™ãƒ¼ã‚¿ãƒ˜ã‚™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼" tabindex="-1"><a class="header-anchor" href="#å•é¡Œ1-ãƒ†ã‚™ãƒ¼ã‚¿ãƒ˜ã‚™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼"><span>å•é¡Œ1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose logs db</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> app <span class="token function">ping</span> db</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> app <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> DB_</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å•é¡Œ2-ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‹ã‚™å¤±æ•—ã™ã‚‹" tabindex="-1"><a class="header-anchor" href="#å•é¡Œ2-ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‹ã‚™å¤±æ•—ã™ã‚‹"><span>å•é¡Œ2: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã™ã‚‹</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ãƒ­ã‚°ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> inspect <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> compose <span class="token function">ps</span> <span class="token parameter variable">-q</span> app<span class="token variable">)</span></span> <span class="token operator">|</span> jq <span class="token string">&#39;.[0].State.Health&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ‰‹å‹•ã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> app <span class="token function">curl</span> localhost:5000/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># MySQLã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> db mysqladmin <span class="token function">ping</span> <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-u</span> flask_user <span class="token parameter variable">-pflask_password</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å•é¡Œ3-ãƒ†ãƒ¼ãƒ•ã‚™ãƒ«ã‹ã‚™ä½œæˆã•ã‚Œãªã„" tabindex="-1"><a class="header-anchor" href="#å•é¡Œ3-ãƒ†ãƒ¼ãƒ•ã‚™ãƒ«ã‹ã‚™ä½œæˆã•ã‚Œãªã„"><span>å•é¡Œ3: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œãªã„</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚ŒãŸã‹ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose logs db <span class="token operator">|</span> <span class="token function">grep</span> init.sql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒ†ãƒ¼ãƒ–ãƒ«ã®å­˜åœ¨ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token builtin class-name">exec</span> db mysql <span class="token parameter variable">-u</span> flask_user <span class="token parameter variable">-pflask_password</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;SHOW TABLES;&quot;</span> flask_app</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¦å†åˆæœŸåŒ–</span></span>
<span class="line"><span class="token function">docker</span> compose down <span class="token parameter variable">-v</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å•é¡Œ4-ãƒ›ã‚šãƒ¼ãƒˆã‹ã‚™ã™ã¦ã‚™ã«ä½¿ç”¨ä¸­" tabindex="-1"><a class="header-anchor" href="#å•é¡Œ4-ãƒ›ã‚šãƒ¼ãƒˆã‹ã‚™ã™ã¦ã‚™ã«ä½¿ç”¨ä¸­"><span>å•é¡Œ4: ãƒãƒ¼ãƒˆãŒã™ã§ã«ä½¿ç”¨ä¸­</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># ä½¿ç”¨ä¸­ã®ãƒãƒ¼ãƒˆã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tulpn</span> <span class="token operator">|</span> <span class="token function">grep</span> :5000</span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tulpn</span> <span class="token operator">|</span> <span class="token function">grep</span> :3306</span>
<span class="line"></span>
<span class="line"><span class="token comment"># åˆ¥ã®ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨</span></span>
<span class="line"><span class="token comment"># compose.ymlã® ports ã‚’å¤‰æ›´</span></span>
<span class="line"><span class="token comment"># &quot;5001:5000&quot; ã‚„ &quot;3307:3306&quot; ãªã©</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å•é¡Œ5-å‰ç« ã®ã‚¤ãƒ¡ãƒ¼ã‚·ã‚™ã‹ã‚™è¦‹ã¤ã‹ã‚‰ãªã„" tabindex="-1"><a class="header-anchor" href="#å•é¡Œ5-å‰ç« ã®ã‚¤ãƒ¡ãƒ¼ã‚·ã‚™ã‹ã‚™è¦‹ã¤ã‹ã‚‰ãªã„"><span>å•é¡Œ5: å‰ç« ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># åˆ©ç”¨å¯èƒ½ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèª</span></span>
<span class="line"><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> flask</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¿…è¦ã«å¿œã˜ã¦Dockerfileã§ãƒ“ãƒ«ãƒ‰</span></span>
<span class="line"><span class="token comment"># compose.ymlã§ image ã‚’ build ã«å¤‰æ›´</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" tabindex="-1"><a class="header-anchor" href="#å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ"><span>å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</span></a></h2><ul><li>[ ] ãƒãƒ³ã‚ºã‚ªãƒ³1: Flask + NGINX æ§‹æˆãŒå‹•ä½œã—ãŸ</li><li>[ ] ãƒãƒ³ã‚ºã‚ªãƒ³2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆã§ãƒ‡ãƒ¼ã‚¿ãŒæ°¸ç¶šåŒ–ã•ã‚ŒãŸ</li><li>[ ] ãƒãƒ³ã‚ºã‚ªãƒ³3: ä¸‰å±¤æ§‹æˆã§è² è·åˆ†æ•£ãŒæ©Ÿèƒ½ã—ãŸ</li><li>[ ] ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ï¼ˆname resolutionï¼‰ã‚’ç¢ºèªã§ããŸ</li><li>[ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§èµ·å‹•é †åºãŒåˆ¶å¾¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ</li><li>[ ] ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ã‚ˆã‚‹æ°¸ç¶šåŒ–ã‚’å®Ÿè£…ã§ããŸ</li><li>[ ] ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†ãŒã§ããŸ</li><li>[ ] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ JSON ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããŸ</li></ul><h3 id="é”æˆãƒ¬ãƒ˜ã‚™ãƒ«" tabindex="-1"><a class="header-anchor" href="#é”æˆãƒ¬ãƒ˜ã‚™ãƒ«"><span>é”æˆãƒ¬ãƒ™ãƒ«</span></a></h3><ul><li><strong>åˆç´š</strong>: ãƒãƒ³ã‚ºã‚ªãƒ³1å®Œäº†ï¼ˆã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®ç†è§£ï¼‰</li><li><strong>ä¸­ç´š</strong>: ãƒãƒ³ã‚ºã‚ªãƒ³2å®Œäº†ï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰</li><li><strong>ä¸Šç´š</strong>: ãƒãƒ³ã‚ºã‚ªãƒ³3å®Œäº†ï¼ˆä¸‰å±¤æ§‹æˆã¨è² è·åˆ†æ•£ã®å®Ÿè£…ï¼‰</li></ul><h3 id="æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ•ã‚š" tabindex="-1"><a class="header-anchor" href="#æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ•ã‚š"><span>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</span></a></h3>`,132)),s("ul",null,[s("li",null,[p(t,{to:"/dev/container/03_practical_usage.html"},{default:l(()=>n[3]||(n[3]=[a("ç¬¬3éƒ¨: å®Ÿè·µå¿œç”¨ç·¨")])),_:1}),n[4]||(n[4]=a(" - ã‚ˆã‚Šé«˜åº¦ãªé‹ç”¨æŠ€è¡“ã‚’å­¦ã¼ã†"))])]),n[7]||(n[7]=s("div",{class:"hint-container tip"},[s("p",{class:"hint-container-title"},"ğŸ’¡ ComposeåŸºç¤å®Œäº†ï¼"),s("p",null,"è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®é€£æºã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚æ¬¡ã¯ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³é‹ç”¨ã®æŠ€è¡“ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼")],-1))])}const h=u(v,[["render",g]]),f=JSON.parse('{"path":"/dev/container/02_compose_basic.html","title":"Docker ComposeåŸºç¤ç·¨ - è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®é€£æºã‚’å­¦ã¼ã†","lang":"ja-JP","frontmatter":{"footer":"MIT Licensed","title":"Docker ComposeåŸºç¤ç·¨ - è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®é€£æºã‚’å­¦ã¼ã†","description":"Docker Composeã‚’ä½¿ã£ã¦è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’é€£æºã•ã›ã€å®Ÿç”¨çš„ãªé–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™"},"git":{"updatedTime":1748167275000,"contributors":[{"name":"YUKI_ISHITSUKA","username":"","email":"goegoe0212@outlook.jp","commits":6}],"changelog":[{"hash":"4b094c7becca8e2c8104d3c1caf8f7712e30118d","time":1748167275000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"fix: NGINXã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªç”¨ã«å¤‰æ›´ã—ã€é–¢é€£ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’æ›´æ–°"},{"hash":"31ce4a099975fbde1b5f513b976e3e89aa9443fd","time":1748164980000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"feat: ãƒãƒ³ã‚ºã‚ªãƒ³3ã‚’è¨˜è¼‰"},{"hash":"f76b05fab5a6fda5131b55e86a9dfe069f9bf59e","time":1748160080000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"fix: ãƒãƒ³ã‚ºã‚ªãƒ³ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¨ã‚¤ãƒ¡ãƒ¼ã‚¸åã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«åŸºã¥ã„ã¦å¤‰æ›´"},{"hash":"71225d6543b4c6aaa362561a14b029cb7446772e","time":1748156338000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"fix: ãƒãƒ³ã‚ºã‚ªãƒ³2ã‚’è¨˜è¼‰"},{"hash":"afdbbd18216e6ed2955a6281cb6424f36173ef0b","time":1748154121000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"feat: ãƒãƒ³ã‚ºã‚ªãƒ³1ã‚’è¨˜è¼‰"},{"hash":"abca198e8b78e520351193d9e506b7bd5137155a","time":1748096932000,"email":"goegoe0212@outlook.jp","author":"YUKI_ISHITSUKA","message":"feat: Docker ComposeåŸºç¤ç·¨ã®åˆæœŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ "}]},"filePathRelative":"dev/container/02_compose_basic.md"}');export{h as comp,f as data};
